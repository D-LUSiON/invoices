<div class="heading">
    <h1>Invoice</h1>
    <div class="actions">
        <div class="msg msg-danger" *ngIf="invoiceForm?.invalid; else saveButton">Invalid</div>
        <ng-template #saveButton>
            <button type="button" class="btn" *ngIf="invoiceForm?.dirty" (click)="onSubmit()">
                <div class="ti ti-save"></div>
            </button>
        </ng-template>
    </div>
</div>
<form class="form-container" [formGroup]="invoiceForm" novalidate (ngSubmit)="onSubmit()">
    <div class="invoice-container">
        <div class="invoice-head">
            <div class="invoice-recipient">
                <div class="form-group">
                    <label translate="invoices">Receiver</label>
                    <div class="form-control" readonly>Любомир Пейков</div>
                </div>
                <div class="form-group">
                    <label translate="invoices">BULSTAT</label>
                    <div class="form-control" readonly>7811051085</div>
                </div>
                <div class="form-group">
                    <label translate="invoices">VAT</label>
                    <div class="form-control" readonly>BG7811051085</div>
                </div>
                <div class="form-group">
                    <label translate="invoices">Address</label>
                    <div class="form-control" readonly>София, ул. 11-ти Август №29</div>
                </div>
            </div>
            <div class="invoice-heading">
                <h1 class="text-center" translate="invoices">Invoice</h1>
                <div class="form-group">
                    <label class="text-center" translate="invoices">Number</label>
                    <input type="text" class="form-control text-center" placeholder="{{ 'Invoice number'|translate:'invoices' }}" formControlName="number">
                </div>
                <div class="form-group">
                    <label class="text-center" translate="invoices">Issue date</label>
                    <input type="date" class="form-control text-center" placeholder="Date of issuing" formControlName="issue_date" [max]="today">
                </div>
                <div class="form-group">
                    <label class="text-center" translate="invoices">Creation date</label>
                    <div class="form-control text-center">{{ invoice.creation_date|date:'MMM d, y' }}</div>
                </div>
            </div>
            <div class="invoice-issuer">
                <div class="form-group">
                    <label translate="invoices">Provider</label>
                    <!-- <input type="text" class="form-control" placeholder="Issuer" formControlName="organization"> -->
                    <lib-autocomplete [results]="providers" labelField="organization" idField="id" formControlName="provider"></lib-autocomplete>
                </div>
                <div class="form-group">
                    <label translate="invoices">VAT</label>
                    <p>{{ choosen_provider?.vat || '---'}}</p>
                    <!-- <input type="text" class="form-control" placeholder="---" [value]="choosen_provider?.vat" readonly> -->
                </div>
                <div class="form-group">
                    <label translate="invoices">Address</label>
                    <p>{{ choosen_provider?.address || '---'}}</p>
                    <!-- <input type="text" class="form-control" placeholder="---" [value]="choosen_provider?.address" readonly> -->
                </div>
                <div class="form-group">
                    <label translate="invoices">Accountable person</label>
                    <p>{{ choosen_provider?.acc_person || '---'}}</p>
                    <!-- <input type="text" class="form-control" placeholder="---" [value]="choosen_provider?.acc_person" readonly> -->
                </div>
            </div>
        </div>
        <div class="invoice-goods-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 30px" translate="invoices">#</th>
                        <th translate="invoices">Name of goods/service</th>
                        <th style="width: 10%" translate="invoices">Measure</th>
                        <th style="width: 10%" translate="invoices">Qty.</th>
                        <th style="width: 10%" translate="invoices">Unit price</th>
                        <th style="width: 5%" translate="invoices">VAT (%)</th>
                        <th style="width: 10%" translate="invoices">Total</th>
                        <th style="width: 5%"></th>
                    </tr>
                </thead>
                <tbody formGroupName="goods">
                    <tr [formArrayName]="idx" *ngFor="let row of invoiceForm.get('goods')['controls']; let idx = index">
                        <td>{{ idx + 1 }}</td>
                        <td>
                            <input type="text" class="form-control" formControlName="title">
                        </td>
                        <td>
                            <input type="text" class="form-control text-right" formControlName="measure">
                        </td>
                        <td>
                            <input type="text" class="form-control text-right" formControlName="quantity">
                        </td>
                        <td>
                            <input type="text" class="form-control text-right" formControlName="price">
                        </td>
                        <td>
                            20%
                        </td>
                        <td class="text-right">
                            {{ invoiceForm.value['goods'][idx].quantity * invoiceForm.value['goods'][idx].price }}
                        </td>
                        <td>
                            <button type="button" class="btn btn-default" (click)="removeNewGoodsRow(idx)">
                                <span class="mdl2-RemoveFrom"></span>
                            </button>
                            <button type="button" class="btn btn-default" *ngIf="idx === invoiceForm.value['goods'].length - 1" (click)="addNewGoodsRow()">
                                <span class="mdl2-AddTo"></span>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="invoice-sum-container">
            <div class="invoice-notes-container">
                <label translate="invoices">Notes:</label>
                <textarea class="form-control invoice-notes" formControlName="notes"></textarea>
            </div>
            <div class="sum-container">
                <div class="cell" translate="invoices">Tax base (20%)</div>
                <div class="cell text-right">{{ invoice.total_sum }} {{ currency_sign }}</div>
                <div class="cell" translate="invoices">VAT charged</div>
                <div class="cell text-right">{{ invoice.total_vat }} {{ currency_sign }}</div>
                <div class="cell">
                    <strong translate="invoices">Payment amount</strong>
                </div>
                <div class="cell text-right">{{ invoice.payment_amount }} {{ currency_sign }}</div>
            </div>
        </div>
    </div>
    <!-- <fieldset>
        <legend>Invoice data ({{ invoiceForm?.invalid }})</legend>
        <div class="form-group">
            <label>Number</label>
            <input type="text" class="form-control" placeholder="Invoice number" formControlName="number">
        </div>
        <div class="form-group">
            <label>Issue date</label>
            <input type="date" class="form-control" placeholder="Date of issuing" formControlName="issue_date" [max]="today">
        </div>
        <div class="form-group">
            <label>Type</label>
            <input type="text" class="form-control" placeholder="Type of the invoice" formControlName="type">
        </div>
        <div class="form-group">
            <label>Notes</label>
            <textarea class="form-control" placeholder="Notes" formControlName="notes"></textarea>
        </div>
    </fieldset>
    <fieldset formGroupName="provider">
        <legend>Provider</legend>
        <div class="form-group">
            <label>Provider name</label>
            <input type="text" class="form-control" placeholder="Provider name" formControlName="organization">
        </div>
        <div class="form-group">
            <label>Accountable person</label>
            <input type="text" class="form-control" placeholder="Accountable person" formControlName="acc_person">
        </div>
        <div class="form-group">
            <label>Address</label>
            <input type="text" class="form-control" placeholder="Address" formControlName="address">
        </div>
        <div class="form-group">
            <label>VAT</label>
            <input type="text" class="form-control" placeholder="VAT" formControlName="vat">
        </div>
        <div class="form-group">
            <label>VAT2</label>
            <input type="text" class="form-control" placeholder="VAT2" formControlName="vat2">
        </div>
    </fieldset>
    <fieldset>
        <legend>Invoice sum</legend>
        <div class="form-group">
            <label>Total sum</label>
            <input type="text" class="form-control" placeholder="Total sum" formControlName="total_sum">
        </div>
    </fieldset> -->
</form>
